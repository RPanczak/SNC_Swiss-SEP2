---
title: "Swiss-SEP 2.0"
description: "microgis geography"
date: "`r Sys.Date()`"
author:
  - name: Radoslaw Panczak 
    url: https://github.com/RPanczak
    affiliation: ISPM
    affiliation_url: https://www.ispm.unibe.ch/
    orcid_id: 0000-0001-5141-683X
# bibliography: biblio.bib
output:
  distill::distill_article:
    highlight: pygments
    toc: true
    toc_depth: 1
    number_sections: true
editor_options: 
  chunk_output_type: console
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding = encoding, output_dir = "../docs") })
---

<!-- ------------------------------------------------------------ --> 

```{r setup, include=FALSE}
options(scipen=999)
set.seed(12345)

library(pacman) 
p_load(tidyverse, scales, sf, tmap, tmaptools)

tmap_mode("view") # makes map interactive
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, 
                      cache = FALSE, 
                      # fig.width=8, fig.height=6, 
                      # out.width="800px", out.height="600px",
                      dpi=300)

knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
```

<!-- ------------------------------------------------------------ --> 

# Data

## Swiss-SEP 

Using version 3.0. 

```{r echo=FALSE}
sep3 <- read_rds("FINAL/RDS/ssep3_user_geo.Rds") %>% 
  select(gisid, ssep3, ssep3_d) %>% 
  mutate(ssep3_d = factor(ssep3_d,
                          levels = 1:10,
                          labels = c("1st - lowest", 
                                     "2", "3", "4", 
                                     "5th decile", 
                                     "6", "7", "8", "9", 
                                     "10th - highest")))
```

Dataset consists of `r scales::number(nrow(sep3), big.mark = ",")` n'hoods, each assigned to decile of index.

```{r}
st_drop_geometry(sep3) %>% 
  frq(ssep3_d)
```

## microgis regions

Sample of data for Bern agglo region. Two levels of geography.  

```{r}
SA_LC_2021_BE <- st_read("data-raw/microgis/sample_unibe/echantillon/SA_LC_2021_BE.shp") %>% 
  st_transform(2056) 

SA_NB_2021_BE <- st_read("data-raw/microgis/sample_unibe/echantillon/SA_NB_2021_BE.shp") %>% 
  st_transform(2056) %>% 
  st_make_valid()
```

```{r eval=FALSE, include=FALSE}
table(st_is_valid(SA_LC_2021_BE))
qtm(SA_LC_2021_BE)

table(st_is_valid(SA_NB_2021_BE))

# SA_NB_2021_BE %>% 
#   filter(!st_is_valid(.)) %>% 
#   qtm(borders = "red", fill = NULL)

qtm(SA_NB_2021_BE)
```

`LC` dataset consists of `r scales::number(nrow(SA_LC_2021_BE), big.mark = ",")` areas  

```{r echo=FALSE}
tm_shape(SA_LC_2021_BE) + 
  tm_polygons(col = "LOCALITY", border.col = "grey40", alpha = 0.5, id = "ZIPLOC") 
```

`NB` dataset consists of `r scales::number(nrow(SA_NB_2021_BE), big.mark = ",")` areas  

```{r}
tm_shape(SA_NB_2021_BE) + 
  tm_polygons(col = "LOCALITY", border.col = "grey40", alpha = 0.5, id = "NBID") 
```

<!-- ------------------------------------------------------------ --> 

# Comparison

## N'hood average SEP for Medstat

## Population based average SEP for Medstat



